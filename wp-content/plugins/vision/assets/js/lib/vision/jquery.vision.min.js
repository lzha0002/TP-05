!function(L,l,r,e){"use strict";var k=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},y=function(){var t=r.createElement("fakeelement"),o={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var i in o)if(t.style[i]!==e)return o[i];return null},n=function(t){try{if(t&&"function"==typeof URL){var o=new URL(l.location.href),i="https:";if(o.protocol==i)return(o=new URL(t)).protocol=i,o.href}}catch(t){}return t},h="vision-instance",i=0;!function(){for(var t=null,o=r.getElementsByTagName("script"),i=0;i<o.length;i++)if(/jquery.vision/.test(o[i].src)){t=o[i].src.substring(o[i].src.lastIndexOf("/")),t=o[i].src.replace(t,"");break}}();function p(t,o){i++,this.$container=null,this.config=null,this.controls={},this.imageWidth=0,this.imageHeight=0,this.layers=[],this.bodyClick=!1,this.themeClass=null,this.lightboxThemeClass=null,this.timerIdResize=null,this.timerIdScroll=null,this.elementZindex=[],this.inboxLayer=null,this.lightboxLayer=null,this.ready=!1,this._init(t,o)}p.prototype={VERSION:"1.4.0",defaults:{theme:"default",width:null,height:null,imgSrc:null,delayResize:50,layers:[],fonts:[],className:null,onPreInit:null,onLoad:null},defaultsLayer:{id:null,type:null,x:0,y:0,width:null,height:null,angle:null,autoWidth:!1,autoHeight:!1,url:null,urlNewWindow:!1,scaling:!1,noevents:!1,tooltip:null,popover:null,data:null,dataSelector:null,className:null},defaultsTooltip:{active:!0,placement:"top",offset:{top:0,left:0},width:null,widthFromCSS:!1,trigger:"hover",followCursor:!1,scaling:!1,interactive:!0,smart:!1,showOnInit:!1,showAnimation:null,hideAnimation:null,duration:200,data:null,dataSelector:null,className:null},defaultsPopover:{active:!0,type:"tooltip",placement:"top",offset:{x:0,y:0},scaling:!1,interactive:!0,smart:!0,mobileType:"lightbox",trigger:"hover",showAnimation:null,hideAnimation:null,duration:300,className:null},lightbox:{layer:null,theme:null,controls:{}},_init:function(t,o){this.$container=t,this.config=o,this._create()},_create:function(){var o=this;function i(){o._buildDOM(),o._setTheme(o.config.theme),o._bind(),o._initLayers(),o._beforeReady(),o._updateSize(),o._ready()}var e=new Image;e.onload=L.proxy(function(t){o.imageWidth=e.width,o.imageHeight=e.height,setTimeout(i,300)},this),e.onerror=L.proxy(function(t){console.error('Cannot load image "'+o.config.imgSrc+'"')},this),e.src=o.config.imgSrc},_setTheme:function(t){this.$container.removeClass(this.themeClass),this.themeClass=t?"vision-theme-"+t.toLowerCase():null,this.lightboxThemeClass=t?"vision-lightbox-theme-"+t.toLowerCase():null,this.$container.addClass(this.themeClass)},_buildDOM:function(){if(this.controls.$image=L("<div>").addClass("vision-image").css({"background-image":"url("+this.config.imgSrc+")"}),this.controls.$stage=L("<div>").addClass("vision-stage"),this.controls.$layers=L("<div>").addClass("vision-layers"),this.controls.$tooltips=L("<div>").addClass("vision-tooltips"),this.controls.$popovers=L("<div>").addClass("vision-popovers"),this.controls.$lastLayer=L("<div>").addClass("vision-layer-last").attr("tabindex",1),this.controls.$inbox=L("<div>").addClass("vision-inbox").addClass("vision-hide").attr("tabindex",1),this.controls.$inboxInner=L("<div>").addClass("vision-inner"),this.controls.$inboxForm=L("<div>").addClass("vision-form"),this.controls.$inboxFrame=L("<div>").addClass("vision-frame"),this.controls.$inboxClose=L("<div>").addClass("vision-close"),this.controls.$inbox.append(this.controls.$inboxInner.append(this.controls.$inboxForm.append(this.controls.$inboxFrame,this.controls.$inboxClose))),this.lightbox.controls.$lightbox||(this.lightbox.controls.$lightbox=L("<div>").addClass("vision-lightbox").addClass("vision-hide").attr("tabindex",1),this.lightbox.controls.$lightboxInner=L("<div>").addClass("vision-inner"),this.lightbox.controls.$lightboxForm=L("<div>").addClass("vision-form"),this.lightbox.controls.$lightboxFrame=L("<div>").addClass("vision-frame"),this.lightbox.controls.$lightboxClose=L("<div>").addClass("vision-close"),this.lightbox.controls.$lightbox.append(this.lightbox.controls.$lightboxInner.append(this.lightbox.controls.$lightboxForm.append(this.lightbox.controls.$lightboxFrame,this.lightbox.controls.$lightboxClose))),L("body").append(this.lightbox.controls.$lightbox),this.lightbox.controls.$lightboxClose.on("click",L.proxy(this._onLightboxCloseClick,this)),this.lightbox.controls.$lightbox.on("keydown",L.proxy(this._onLightboxKeyboard,this))),this.controls.$stage.append(this.controls.$layers.append(this.controls.$lastLayer),this.controls.$tooltips,this.controls.$popovers),this.controls.$image.append(this.controls.$stage),this.$container.prepend(this.controls.$image,this.controls.$inbox).addClass("vision-map").addClass(this.config.className),null!=this.config.width&&this.$container.css({width:this.config.width}),null!=this.config.height&&this.$container.css({height:this.config.height}),this.config.fonts)for(var t=0;t<this.config.fonts.length;t++){var o=this.config.fonts[t],i=o.replace(new RegExp("[+]|[:]","g"),"");if(0==L("#"+i).length){var e=r.getElementsByTagName("head")[0],s=r.createElement("link");s.setAttribute("id",i),s.setAttribute("rel","stylesheet"),s.setAttribute("href","https://fonts.googleapis.com/css?family="+o),e.appendChild(s)}}},_bind:function(){L(l).on("resize",L.proxy(this._onResize,this)),L(l).on("scroll",L.proxy(this._onScroll,this)),L("body").on("click",L.proxy(this._onBodyClickTooltip,this)),this.controls.$lastLayer.on("focus",L.proxy(this._onLastLayerFocus,this)),this.controls.$inboxClose.on("click",L.proxy(this._onInboxCloseClick,this)),this.controls.$inbox.on("keydown",L.proxy(this._onInboxKeyboard,this))},_unbind:function(){L(l).off("resize",L.proxy(this._onResize,this)),L(l).off("scroll",L.proxy(this._onScroll,this)),L("body").off("click",L.proxy(this._onBodyClickTooltip,this)),this.controls.$lastLayer.off("focus",L.proxy(this._onLastLayerFocus,this)),this.controls.$inboxClose.off("click",L.proxy(this._onInboxCloseClick,this)),this.controls.$inbox.off("keydown",L.proxy(this._onInboxKeyboard,this))},_beforeReady:function(){this.$container.addClass("vision-before-ready"),this.$container.get(0).offsetHeight,this.$container.is(":hidden")&&this.$container.css("display","block");for(var t=0;t<this.layers.length;t++){var o=this.layers[t];if(!o.cfg.tooltip.widthFromCSS){var i=o.$tooltipData.get(0).getBoundingClientRect(),e=o.cfg.tooltip.width?o.cfg.tooltip.width:i.width+1;o.$tooltipData.css({width:e})}if(o.$tooltipPos.css({width:"auto"}),!o.cfg.popover.widthFromCSS){i=o.$popover.get(0).getBoundingClientRect(),e=o.cfg.popover.width?o.cfg.popover.width:i.width+1;o.$popover.css({width:e})}o.$popoverPos.css({width:"auto"}),(o.cfg.tooltip.showOnInit||"sticky"==o.cfg.tooltip.trigger)&&this._showTooltip(o),o.cfg.popover.showOnInit&&this._showPopover(o)}this.$container.removeClass("vision-before-ready")},_ready:function(){if(this.config.onLoad){var t=null;if("string"==typeof this.config.onLoad)try{t=new Function(this.config.onLoad)}catch(t){console.error("Can not compile onLoad function: "+t.message)}else"function"==typeof this.config.onLoad&&(t=this.config.onLoad);t&&t.call(this)}this.$container.addClass("vision-ready"),this.ready=!0,this.$container.trigger("vision:ready",[this])},_destroy:function(){this._unbind(),this.controls.$image.remove(),this.controls.$inbox.remove(),this.$container.removeClass("vision-ready").removeClass("vision-map").removeClass(this.config.className),this._setTheme(null),0==--i&&(this.lightbox.controls.$lightbox.remove(),L("body").removeClass("vision-lightbox-active"))},_updateSize:function(){var t=this.imageHeight/this.imageWidth,o=this.$container.width(),i=null==this.config.height?t*o:this.$container.height();null==this.config.height&&this.controls.$image.css({height:i});for(var e=o/this.imageWidth,s=i/this.imageHeight,a=0;a<this.layers.length;a++){var l=this.layers[a];l.cfg.scaling&&l.$layerZoom.css({transform:"scale("+e+","+s+")"}),l.cfg.tooltip.scaling&&l.$tooltipZoom.css({transform:"scale("+e+","+s+")"}),l.tooltipVisible&&this._showTooltip(l),l.cfg.popover.scaling&&"tooltip"==l.cfg.popover.type&&(l.$popoverZoom.css({transform:"scale("+e+","+s+")"}),l.popoverVisible&&this._showPopover(l))}},_updatePlacement:function(){for(var t=0;t<this.layers.length;t++){var o=this.layers[t];o.tooltipVisible&&this._showTooltip(o),o.popoverVisible&&this._showPopover(o)}},_initLayers:function(){if(this.config.layers)for(var t=0;t<this.config.layers.length;t++){var o=this.config.layers[t];this._addLayer(o)}this.$container.find(".vision-store").remove()},_addLayer:function(t){t.tooltip=L.extend(!0,{},this.defaultsTooltip,t.tooltip),t.popover=L.extend(!0,{},this.defaultsPopover,t.popover);t=L.extend(!0,{},this.defaultsLayer,t);var o=L("<div>").addClass("vision-layer").addClass(t.className),i=L("<div>").addClass("vision-pos").css({top:t.y+"%",left:t.x+"%"}),e=L("<div>").addClass("vision-zoom"),s=L("<div>").addClass("vision-offset"),a=L("<div>").addClass("vision-body");if(t.id||(t.id=this.uuid()),t.noevents&&o.addClass("vision-noevents"),o.attr("data-layer-id",t.id),o.attr("data-layer-type",t.type),o.attr("data-layer-title",t.title),t.url&&o.addClass("vision-url"),"focus"!=t.tooltip.trigger&&"focus"!=t.popover.trigger||o.attr("tabindex",1),t.autoWidth||null==t.width||a.css({width:t.width}),t.autoHeight||null==t.height||a.css({height:t.height}),null!=t.angle&&a.css({transform:"rotate("+t.angle+"deg)"}),t.data)a.html(t.data);else if(t.dataSelector){(_=L(t.dataSelector)).length&&(_.detach(),a.append(_))}else{if((_=this.$container.find('.vision-store .vision-layers-data [data-layer-id="'+t.id+'"]')).length)(w=_.contents()).detach(),a.append(w),_.remove()}o.append(i.append(e.append(s.append(a)))),this.controls.$layers.append(o),this.controls.$lastLayer.detach(),this.controls.$layers.append(this.controls.$lastLayer);var l=L("<div>").addClass("vision-tooltip").addClass("vision-hide").addClass(t.tooltip.className),r=L("<div>").addClass("vision-pos").css({top:t.y+"%",left:t.x+"%"}),n=L("<div>").addClass("vision-zoom"),h=L("<div>").addClass("vision-offset"),p=L("<div>").addClass("vision-form"),c=L("<div>").addClass("vision-arrow"),d=L("<div>").addClass("vision-body"),g=L("<div>").addClass("vision-data");if(l.attr("data-layer-id",t.id),(t.tooltip.showAnimation||t.tooltip.hideAnimation)&&t.tooltip.duration&&p.css({"animation-duration":t.tooltip.duration+"ms","-webkit-animation-duration":t.tooltip.duration+"ms"}),t.tooltip.data)g.html(t.tooltip.data);else if(t.tooltip.dataSelector){(_=L(t.tooltip.dataSelector)).length&&(_.detach(),g.append(_))}else{if((_=this.$container.find('.vision-store .vision-tooltips-data [data-layer-id="'+t.id+'"]')).length)(w=_.contents()).detach(),g.append(w),_.remove()}l.append(r.append(n.append(h.append(p.append(d.append(g),c))))),this.controls.$tooltips.append(l);var f=L("<div>").addClass("vision-popover").addClass("vision-hide").addClass(t.popover.className),v=L("<div>").addClass("vision-pos").css({top:t.y+"%",left:t.x+"%"}),b=L("<div>").addClass("vision-zoom"),m=L("<div>").addClass("vision-offset"),y=L("<div>").addClass("vision-form"),u=L("<div>").addClass("vision-arrow"),x=L("<div>").addClass("vision-body"),$=L("<div>").addClass("vision-data");f.attr("data-layer-id",t.id);var C=k()?t.popover.mobileType:t.popover.type;if(f.attr("data-type",C),t.popover.data)f.html(t.popover.data);else if(t.popover.dataSelector){(_=L(t.popover.dataSelector)).length&&(_.detach(),f.append(_))}else{var _,w;if((_=this.$container.find('.vision-store .vision-popovers-data [data-layer-id="'+t.id+'"]')).length)(w=_.contents()).detach(),$.append(w),_.remove()}f.append(v.append(b.append(m.append(y.append(x.append($),u))))),this.controls.$popovers.append(f);t={$layer:o,$layerPos:i,$layerZoom:e,$layerOffset:s,$layerBody:a,$tooltip:l,$tooltipPos:r,$tooltipZoom:n,$tooltipOffset:h,$tooltipForm:p,$tooltipBody:d,$tooltipData:g,tooltipVisible:!1,$popover:f,$popoverPos:v,$popoverZoom:b,$popoverOffset:m,$popoverForm:y,$popoverBody:x,$popoverData:$,popoverVisible:!1,cfg:t};return this._bindLayer(t),this.layers.push(t),this._updateBodyClick(),t.id},_bindLayer:function(t){switch(t.cfg.url&&t.$layer.on("click",L.proxy(this._onLayerClickLink,this,t)),t.cfg.tooltip.trigger){case"hover":t.$layer.on("mouseenter",L.proxy(this._onLayerEnterTooltip,this,t)),t.$layer.on("mouseleave",L.proxy(this._onLayerLeaveTooltip,this,t)),k()&&(t.$layer.on("focus",L.proxy(this._onLayerFocusTooltip,this,t)),t.$layer.on("blur",L.proxy(this._onLayerBlurTooltip,this,t)));break;case"focus":t.$layer.on("focus",L.proxy(this._onLayerFocusTooltip,this,t)),t.$layer.on("blur",L.proxy(this._onLayerBlurTooltip,this,t));break;case"click":case"clickbody":t.$layer.on("click",L.proxy(this._onLayerClickTooltip,this,t))}switch(t.cfg.popover.trigger){case"hover":t.$layer.on("mouseenter",L.proxy(this._onLayerEnterPopover,this,t)),t.$layer.on("mouseleave",L.proxy(this._onLayerLeavePopover,this,t)),k()&&(t.$layer.on("focus",L.proxy(this._onLayerFocusPopover,this,t)),t.$layer.on("blur",L.proxy(this._onLayerBlurPopover,this,t)));break;case"focus":t.$layer.on("focus",L.proxy(this._onLayerFocusPopover,this,t)),t.$layer.on("blur",L.proxy(this._onLayerBlurPopover,this,t));break;case"click":t.$layer.on("click",L.proxy(this._onLayerClickPopover,this,t));break;case"dblclick":t.$layer.on("dblclick",L.proxy(this._onLayerClickPopover,this,t))}},_deleteLayer:function(t){if(0<=t&&t<this.layers.length){var o=this.layers[t];return o.$layer.remove(),o.$tooltip.remove(),this.layers.splice(t,1),!0}return!1},_updateBodyClick:function(){this.bodyClick=!1;for(var t=0;t<this.layers.length;t++){var o=this.layers[t];if("clickbody"==o.cfg.tooltip.trigger||"focus"==o.cfg.tooltip.trigger){this.bodyClick=!0;break}}},_getViewportOffset:function(t){var o=L(l),i=o.scrollLeft(),e=o.scrollTop(),s=t.get(0).getBoundingClientRect(),a=t.offset();return{left:a.left-i,top:a.top-e,bottom:Math.max(r.documentElement.clientHeight,l.innerHeight||0)-a.top+e-s.height,right:Math.max(r.documentElement.clientWidth,l.innerWidth||0)-a.left+i-s.width}},_showTooltip:function(t,o,i,e){if(t.cfg.tooltip.active){var s=this.imageHeight/this.imageWidth,a=this.$container.width(),l=null==this.config.height?s*a:this.$container.height(),r=a/this.imageWidth,n=l/this.imageHeight,h="hover"==t.cfg.tooltip.trigger&&t.cfg.tooltip.followCursor?5:t.cfg.height*(t.cfg.scaling&&!t.cfg.tooltip.scaling?n:1)/2,p="hover"==t.cfg.tooltip.trigger&&t.cfg.tooltip.followCursor?5:t.cfg.width*(t.cfg.scaling&&!t.cfg.tooltip.scaling?r:1)/2,c=t.cfg.tooltip.offset.top,d=t.cfg.tooltip.offset.left;switch(o=o||!1,i=i||t.cfg.tooltip.placement,e=e||!1,t.$tooltip.removeClass(t.$tooltip.data("placement")),i&&t.$tooltip.addClass("vision-"+i).data("placement","vision-"+i),i){case"top":h=-h,p=0;break;case"right":h=0,p=p;break;case"bottom":h=h,p=0;break;case"left":h=0,p=-p;break;case"top-left":h=-h,p=-p;break;case"top-right":case"right-top":h=-h,p=p;break;case"right-bottom":h=h,p=p;break;case"bottom-left":h=h,p=-p;break;case"bottom-right":h=h,p=p;break;case"left-top":h=-h,p=-p;break;case"left-bottom":h=h,p=-p;break;default:h=p=t.cfg.tooltip.followCursor?5:0}if(t.$tooltipOffset.css({"margin-top":h,"margin-left":p}),t.cfg.tooltip.followCursor&&"hover"==t.cfg.tooltip.trigger&&(t.$layer.on("mousemove",L.proxy(this._onLayerMouseMoveTooltip,this,t)),t.$tooltip.addClass("vision-noevents-hard")),t.$tooltipPos.css({top:t.cfg.y+"%",left:t.cfg.x+"%","margin-top":c,"margin-left":d}),!t.tooltipVisible){t.tooltipVisible=!0,t.$tooltip.addClass("vision-show").removeClass("vision-hide");var g=0<this.elementZindex.length?Math.max.apply(null,this.elementZindex)+1:1;this.elementZindex.push(g),t.$tooltipPos.css("z-index",g),o&&t.cfg.tooltip.showAnimation&&(t.$tooltipForm.removeClass(t.cfg.tooltip.showAnimation).removeClass(t.cfg.tooltip.hideAnimation),t.$tooltipForm.addClass(t.cfg.tooltip.showAnimation),t.$tooltipForm.one(y(),L.proxy(function(t,o){L(o.target).removeClass(t.cfg.tooltip.showAnimation)},this,t)))}if(!e&&t.cfg.tooltip.smart){var f=this._getViewportOffset(t.$layerOffset),v=this._getViewportOffset(t.$tooltipOffset),b=t.$layerOffset.get(0).getBoundingClientRect(),m=t.$tooltipOffset.get(0).getBoundingClientRect();switch(i){case"top-left":v.right<0&&(i=0<f.left+b.width-m.width?i.replace("-left","-right"):i.replace("-left","")),v.top<0&&(i=i.replace("top","bottom"));break;case"top":v.right<0&&0<f.left+b.width-m.width&&(i+="-right"),v.left<0&&0<f.right+b.width-m.width&&(i+="-left"),v.top<0&&(i=i.replace("top","bottom"));break;case"top-right":v.left<0&&(i=0<f.right+b.width-m.width?i.replace("-right","-left"):i.replace("-right","")),v.top<0&&(i=i.replace("top","bottom"));break;case"right-top":v.top<0&&b.height>m.height&&(i=i.replace("-top","-bottom")),v.right<0&&(i=i.replace("right","left"));break;case"right":v.top<0&&(b.height>m.height?i+="-bottom":i+="-top"),v.bottom<0&&(b.height>m.height?i+="-top":i+="-bottom"),v.right<0&&(i=i.replace("right","left"));break;case"right-bottom":v.bottom<0&&b.height>m.height&&(i=i.replace("-bottom","-top")),v.right<0&&(i=i.replace("right","left"));break;case"bottom-right":v.left<0&&(i=0<f.right+b.width-m.width?i.replace("-right","-left"):i.replace("-right","")),v.bottom<0&&(i=i.replace("bottom","top"));break;case"bottom":v.right<0&&0<f.left+b.width-m.width&&(i+="-right"),v.left<0&&0<f.right+b.width-m.width&&(i+="-left"),v.top<0&&(i=i.replace("bottom","top"));break;case"bottom-left":v.right<0&&(i=0<f.left+b.width-m.width?i.replace("-left","-right"):i.replace("-left","")),v.bottom<0&&(i=i.replace("bottom","top"));break;case"left-bottom":v.bottom<0&&b.height>m.height&&(i=i.replace("-bottom","-top")),v.left<0&&(i=i.replace("left","right"));break;case"left":v.top<0&&(b.height>m.height?i+="-bottom":i+="-top"),v.bottom<0&&(b.height>m.height?i+="-top":i+="-bottom"),v.left<0&&(i=i.replace("left","right"));break;case"left-top":v.top<0&&b.height>m.height&&(i=i.replace("-top","-bottom")),v.left<0&&(i=i.replace("left","right"))}this._showTooltip(t,!1,i,!0)}}},_hideTooltip:function(t){t.$layer.off("mousemove",L.proxy(this._onLayerMouseMoveTooltip,t,this)),t.$tooltip.removeClass("vision-noevents-hard"),t.tooltipVisible&&(t.tooltipVisible=!1,t.cfg.tooltip.hideAnimation?(t.$tooltipForm.removeClass(t.cfg.tooltip.showAnimation).removeClass(t.cfg.tooltip.hideAnimation),t.$tooltipForm.addClass(t.cfg.tooltip.hideAnimation),t.$tooltipForm.one(y(),L.proxy(function(t,o){L(o.target).removeClass(t.cfg.tooltip.hideAnimation),t.tooltipVisible||this.__hideTooltip(t)},this,t))):this.__hideTooltip(t))},__hideTooltip:function(t){t.$tooltip.addClass("vision-hide").removeClass("vision-show"),t.$tooltip.removeClass(t.$tooltip.data("placement"));var o=this.elementZindex.indexOf(parseInt(t.$tooltipPos.css("z-index"),10));-1<o&&this.elementZindex.splice(o,1),t.$tooltipPos.css("z-index",""),t.$tooltipData.detach(),t.$tooltipData.get(0).offsetHeight,t.$tooltipData.appendTo(t.$tooltipBody)},_onLayerClickLink:function(t,o){t.cfg.url&&l.open(t.cfg.url,t.cfg.urlNewWindow?"_blank":"_self")},_onLayerEnterTooltip:function(t,o){this._showTooltip(t,!0)},_onLayerLeaveTooltip:function(t,o){var i=o.relatedTarget||o.toElement;t.cfg.tooltip.interactive&&(0!==t.$tooltip.has(i).length||t.$tooltip.is(i))||t.$layer.is(i)?t.$tooltip.one("mouseleave",L.proxy(this._onLayerLeaveTooltip,this,t)):this._hideTooltip(t)},_onLayerMouseMoveTooltip:function(t,o){var i=this.controls.$stage.get(0).getBoundingClientRect(),e=(o.clientY-i.y)/i.height*100,s=(o.clientX-i.x)/i.width*100;t.$tooltipPos.css({top:e+"%",left:s+"%"})},_onLayerFocusTooltip:function(t,o){this._showTooltip(t,!0)},_onLayerBlurTooltip:function(t,o){this._hideTooltip(t)},_onLayerClickTooltip:function(t,o){t.tooltipVisible?this._hideTooltip(t):this._showTooltip(t,!0)},_onBodyClickTooltip:function(t){if(this.bodyClick)for(var o=t.target||t.relatedTarget||t.toElement,i=0;i<this.layers.length;i++){var e=this.layers[i];0<e.$layer.has(o).length||e.$layer.is(o)||e.tooltipVisible&&("clickbody"==e.cfg.tooltip.trigger||"focus"==e.cfg.tooltip.trigger&&!e.$layer.is(":focus"))&&(!e.tooltipVisible||e.cfg.tooltip.interactive&&(0!==e.$tooltip.has(o).length||e.$tooltip.is(o))||this._hideTooltip(e))}},_onLastLayerFocus:function(t){this.layers.length&&this.layers[0].$layer.focus()},_showPopover:function(t,o,i,e){if(t&&t.cfg.popover.active){var s=k()?t.cfg.popover.mobileType:t.cfg.popover.type;if("tooltip"==s){var a=this.imageHeight/this.imageWidth,l=this.$container.width(),r=null==this.config.height?a*l:this.$container.height(),n=l/this.imageWidth,h=r/this.imageHeight,p=t.cfg.height*(t.cfg.scaling&&!t.cfg.popover.scaling?h:1)/2,c=t.cfg.width*(t.cfg.scaling&&!t.cfg.popover.scaling?n:1)/2,d=t.cfg.popover.offset.top,g=t.cfg.popover.offset.left;switch(o=o||!1,i=i||t.cfg.popover.placement,e=e||!1,t.$popover.removeClass(t.$popover.data("placement")),i&&t.$popover.addClass("vision-"+i).data("placement","vision-"+i),i){case"top-left":p=-p,c=-c;break;case"top":p=-p,c=0;break;case"top-right":case"right-top":p=-p,c=c;break;case"right":p=0,c=c;break;case"right-bottom":case"bottom-right":p=p,c=c;break;case"bottom":p=p,c=0;break;case"bottom-left":case"left-bottom":p=p,c=-c;break;case"left":p=0,c=-c;break;case"left-top":p=-p,c=-c;break;default:p=c=0}if(t.$popoverOffset.css({"margin-top":p,"margin-left":c}),t.$popoverPos.css({top:t.cfg.y+"%",left:t.cfg.x+"%","margin-top":d,"margin-left":g}),!t.popoverVisible){t.popoverVisible=!0,t.$popover.addClass("vision-show").removeClass("vision-hide");var f=0<this.elementZindex.length?Math.max.apply(null,this.elementZindex)+1:1;this.elementZindex.push(f),t.$popoverPos.css("z-index",f)}if(!e&&t.cfg.popover.smart){var v=this._getViewportOffset(t.$layerOffset),b=this._getViewportOffset(t.$popoverOffset),m=t.$layerOffset.get(0).getBoundingClientRect(),y=t.$popoverOffset.get(0).getBoundingClientRect();switch(i){case"top-left":b.right<0&&(i=0<v.left+m.width-y.width?i.replace("-left","-right"):i.replace("-left","")),b.top<0&&(i=i.replace("top","bottom"));break;case"top":b.right<0&&0<v.left+m.width-y.width&&(i+="-right"),b.left<0&&0<v.right+m.width-y.width&&(i+="-left"),b.top<0&&(i=i.replace("top","bottom"));break;case"top-right":b.left<0&&(i=0<v.right+m.width-y.width?i.replace("-right","-left"):i.replace("-right","")),b.top<0&&(i=i.replace("top","bottom"));break;case"right-top":b.top<0&&m.height>y.height&&(i=i.replace("-top","-bottom")),b.right<0&&(i=i.replace("right","left"));break;case"right":b.top<0&&(m.height>y.height?i+="-bottom":i+="-top"),b.bottom<0&&(m.height>y.height?i+="-top":i+="-bottom"),b.right<0&&(i=i.replace("right","left"));break;case"right-bottom":b.bottom<0&&m.height>y.height&&(i=i.replace("-bottom","-top")),b.right<0&&(i=i.replace("right","left"));break;case"bottom-right":b.left<0&&(i=0<v.right+m.width-y.width?i.replace("-right","-left"):i.replace("-right","")),b.bottom<0&&(i=i.replace("bottom","top"));break;case"bottom":b.right<0&&0<v.left+m.width-y.width&&(i+="-right"),b.left<0&&0<v.right+m.width-y.width&&(i+="-left"),b.top<0&&(i=i.replace("bottom","top"));break;case"bottom-left":b.right<0&&(i=0<v.left+m.width-y.width?i.replace("-left","-right"):i.replace("-left","")),b.bottom<0&&(i=i.replace("bottom","top"));break;case"left-bottom":b.bottom<0&&m.height>y.height&&(i=i.replace("-bottom","-top")),b.left<0&&(i=i.replace("left","right"));break;case"left":b.top<0&&(m.height>y.height?i+="-bottom":i+="-top"),b.bottom<0&&(m.height>y.height?i+="-top":i+="-bottom"),b.left<0&&(i=i.replace("left","right"));break;case"left-top":b.top<0&&m.height>y.height&&(i=i.replace("-top","-bottom")),b.left<0&&(i=i.replace("left","right"))}this._showPopover(t,!1,i,!0)}}else"inbox"==s?this._showPopoverInbox(t):"lightbox"==s&&this._showPopoverLightbox(t)}},_hidePopover:function(t){if(t)switch(k()?t.cfg.popover.mobileType:t.cfg.popover.type){case"tooltip":this.__hidePopover(t);break;case"inbox":this._hidePopoverInbox();break;case"lightbox":this._hidePopoverLightbox()}},__hidePopover:function(t){if(t.popoverVisible){t.popoverVisible=!1,t.$popover.addClass("vision-hide").removeClass("vision-show"),t.$popover.removeClass(t.$popover.data("placement"));var o=this.elementZindex.indexOf(parseInt(t.$popoverPos.css("z-index"),10));-1<o&&this.elementZindex.splice(o,1),t.$popoverPos.css("z-index",""),t.$popoverData.detach(),t.$popoverData.get(0).offsetHeight,t.$popoverData.appendTo(t.$popoverBody)}},_onLayerEnterPopover:function(t,o){this._showPopover(t,!0)},_onLayerLeavePopover:function(t,o){var i=o.relatedTarget||o.toElement;t.cfg.popover.interactive&&(0!==t.$popover.has(i).length||t.$popover.is(i))||t.$layer.is(i)?t.$popover.one("mouseleave",L.proxy(this._onLayerLeavePopover,this,t)):this._hidePopover(t)},_onLayerFocusPopover:function(t,o){this._showPopover(t,!0)},_onLayerBlurPopover:function(t,o){this._hidePopover(t)},_onLayerClickPopover:function(t,o){t.popoverVisible?this._hidePopover(t):this._showPopover(t,!0)},_onInboxCloseClick:function(t){this._hidePopoverInbox()},_onInboxKeyboard:function(t){27!==t.keyCode||this._hidePopoverInbox()},_onLightboxCloseClick:function(t){this._hidePopoverLightbox()},_onLightboxKeyboard:function(t){27!==t.keyCode||this._hidePopoverLightbox()},_showPopoverInbox:function(t){this.inboxLayer&&this._hidePopover(this.inboxLayer),this.inboxLayer=t,this.inboxLayer.$popoverData.detach();var o=this.inboxLayer.$popoverData.attr("style");this.inboxLayer.$popoverData.data("style",o),this.inboxLayer.$popoverData.attr("style",""),this.controls.$inbox.addClass(this.inboxLayer.cfg.popover.className),this.controls.$inboxFrame.append(t.$popoverData),this.controls.$inboxFrame.get(0).offsetHeight,this.controls.$inboxFrame.height()>this.controls.$inboxForm.height()&&this.controls.$inboxForm.addClass("vision-inbox-form-overflow"),this.controls.$inbox.addClass("vision-show").removeClass("vision-hide").focus()},_hidePopoverInbox:function(){if(this.inboxLayer){this.inboxLayer.$popoverData.detach();var t=this.inboxLayer.$popoverData.data("style");this.inboxLayer.$popoverData.attr("style",t),this.inboxLayer.$popoverData.data("style",""),this.controls.$inbox.removeClass(this.inboxLayer.cfg.popover.className),this.inboxLayer.$popoverBody.append(this.inboxLayer.$popoverData),this.inboxLayer=null}this.controls.$inbox.addClass("vision-hide").removeClass("vision-show"),this.controls.$inboxForm.removeClass("vision-inbox-form-overflow")},_showPopoverLightbox:function(t){this._hidePopoverLightbox(),this.lightbox.layer=t,this.lightbox.theme=this.lightboxThemeClass,this.lightbox.layer.$popoverData.detach();var o=this.lightbox.layer.$popoverData.attr("style");this.lightbox.layer.$popoverData.data("style",o),this.lightbox.layer.$popoverData.attr("style",""),this.lightbox.controls.$lightbox.addClass(this.lightbox.layer.cfg.popover.className).addClass(this.lightbox.theme),this.lightbox.controls.$lightboxFrame.append(this.lightbox.layer.$popoverData),this.lightbox.controls.$lightboxFrame.get(0).offsetHeight,this.lightbox.controls.$lightboxFrame.height()>this.lightbox.controls.$lightboxForm.height()&&this.lightbox.controls.$lightboxForm.addClass("vision-lightbox-form-overflow"),this.lightbox.controls.$lightbox.addClass("vision-show").removeClass("vision-hide").focus(),L("body").addClass("vision-lightbox-active")},_hidePopoverLightbox:function(){if(L("body").removeClass("vision-lightbox-active"),this.lightbox.controls.$lightbox.removeClass(this.lightbox.theme).addClass("vision-hide").removeClass("vision-show"),this.lightbox.controls.$lightboxForm.removeClass("vision-lightbox-form-overflow"),this.lightbox.theme=null,this.lightbox.layer){this.lightbox.layer.$popoverData.detach();var t=this.lightbox.layer.$popoverData.data("style");this.lightbox.layer.$popoverData.attr("style",t),this.lightbox.layer.$popoverData.data("style",""),this.lightbox.controls.$lightbox.removeClass(this.lightbox.layer.cfg.popover.className),this.lightbox.layer.$popoverBody.append(this.lightbox.layer.$popoverData),this.lightbox.layer=null}},_onResize:function(){if(this.ready){var t=this;clearTimeout(this.timerIdResize),this.timerIdResize=setTimeout(function(){t._updateSize()},this.config.delayResize)}},_onScroll:function(){if(this.ready){var t=this;clearTimeout(this.timerIdScroll),this.timerIdScroll=setTimeout(function(){t._updatePlacement()},100)}},uuid:function(t){var o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=16*Math.random()|0;return("x"==t?o:3&o|8).toString(16)});return 0<t?o.substring(0,t):o},setTheme:function(t){this._setTheme(t)},addLayer:function(t){return this._addLayer(t)},getLayer:function(t){for(var o=0;o<this.layers.length;o++){var i=this.layers[o];if(i.cfg.id==t)return i}return null},deleteLayer:function(t){for(var o=0;o<this.layers.length;o++){if(this.layers[o].cfg.id==t)return this._deleteLayer(o)}return!1},showPopover:function(t){var o=this.getLayer(t);o&&this._showPopover(o)},hidePopover:function(t){var o=this.getLayer(t);o&&this._hidePopover(o)},showTooltip:function(t,o,i,e){var s=this.getLayer(t);s&&this._showTooltip(s,o,i,e)},hideTooltip:function(t){var o=this.getLayer(t);o&&this._hideTooltip(o)},resize:function(){this._updateSize()}},L.fn.vision=function(l,t){if("instance"!=l)return this.each(function(){var i=L(this),e=i.data(h),t=i.data("json-src"),s=i.data("img-src"),a=L.isPlainObject(l)?l:t?null:{};if("destroy"==l)return e?(i.removeData(h),void e._destroy()):void console.error('Calling "destroy" method on not initialized instance is forbidden');function o(){var t=L.extend(!0,{},p.prototype.defaults,a);if(t.baseUrl&&t.baseUrl,null==t.imgSrc&&s&&(t.imgSrc=s),t.onPreInit){var o=null;if("string"==typeof t.onPreInit)try{o=new Function("config",t.onPreInit)}catch(t){console.error('Can not compile "onPreInit" function: '+t.message)}else"function"==typeof t.onPreInit&&(o=t.onPreInit);o&&o.call(this,t)}e=new p(i,t),i.data(h,e)}e&&(i.removeData(h),e._destroy(),e=null),null==a?(t=n(t),L.ajax({url:t,type:"GET",dataType:"json"}).done(function(t){a=L.isPlainObject(t)?t:{}}).fail(function(t){a={}}).always(function(){o()})):o()});var o=L(this).data(h);return o||void console.error('Calling "instance" method on not initialized instance is forbidden')},L(".vision-map").vision()}(jQuery,window,document);